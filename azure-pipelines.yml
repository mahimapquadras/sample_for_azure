# azure-pipelines.yml
# This pipeline runs your Selenium tests from your GitHub repository

trigger:
- main # Triggers the pipeline on pushes to the main branch

pool:
  vmImage: 'ubuntu-latest' # Use a hosted Ubuntu agent

steps:
- checkout: self # This step checks out your GitHub repository into the agent's workspace
  displayName: 'Checkout code from GitHub'

- task: UsePythonVersion@0
  displayName: 'Set up Python 3.9'
  inputs:
    versionSpec: '3.9'

- script: |
    echo "Installing Python dependencies..."
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Install Python dependencies'

# --- BrowserStack Configuration Task (Should run before your tests) ---
- task: BrowserStackConfig@0
  displayName: 'BrowserStack Configuration'
  inputs:
    BrowserStackServiceEndPoint: 'browserstack-connection' # Make sure you have a Service Connection named 'browserstack-connection' in Azure DevOps Project Settings -> Service connections

- script: |
    echo "Running Selenium tests with Pytest..."
    python -m pytest tests/test_azure.py
  displayName: 'Run Selenium Tests'

# --- BrowserStack Results Task (Should run after your tests) ---
- task: BrowserStackResults@1
  displayName: 'Publish BrowserStack Results'
  inputs:
    browserstackProduct: 'automate' # Use 'automate' for Selenium/WebDriver tests